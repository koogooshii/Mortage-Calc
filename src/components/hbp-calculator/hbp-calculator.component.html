<div class="bg-gray-800/50 backdrop-blur-sm rounded-xl shadow-2xl p-6 border border-gray-700 space-y-8 max-w-4xl mx-auto">
    
  <!-- Form Section -->
  <section>
    <form [formGroup]="hbpForm" class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
      <div>
        <label for="withdrawalAmount" class="block text-sm font-medium text-gray-300">HBP Withdrawal Amount</label>
        <input type="number" id="withdrawalAmount" formControlName="withdrawalAmount" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white p-2 focus:ring-pink-500 focus:border-pink-500">
        <p class="text-xs text-gray-400 mt-1">Up to a maximum of {{ HBP_LIMIT | currency:'CAD':'symbol':'1.0-0' }} per person.</p>
      </div>
      <div>
        <label for="marginalTaxRate" class="block text-sm font-medium text-gray-300 flex items-center gap-1">
          <span>Marginal Tax Rate (%)</span>
           <div class="group relative"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-400 cursor-help"><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0zM8.94 6.94a.75.75 0 1 1-1.061-1.061 3 3 0 1 1 2.871 5.026v.345a.75.75 0 0 1-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 1 0 8.94 6.94zM10 15a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" clip-rule="evenodd" /></svg><div class="absolute bottom-full left-1/2 z-20 mb-2 w-64 -translate-x-1/2 transform rounded-lg bg-gray-900 border border-gray-700 p-3 text-center text-xs text-gray-300 opacity-0 shadow-lg transition-opacity group-hover:opacity-100 pointer-events-none">Your combined federal and provincial marginal tax rate. This is used to estimate the tax impact of missed repayments.</div></div>
        </label>
        <input type="number" id="marginalTaxRate" formControlName="marginalTaxRate" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white p-2 focus:ring-pink-500 focus:border-pink-500">
      </div>
      <div>
        <label for="investmentGrowthRate" class="block text-sm font-medium text-gray-300 flex items-center gap-1">
          <span>Est. Annual Growth Rate (%)</span>
           <div class="group relative"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-400 cursor-help"><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0zM8.94 6.94a.75.75 0 1 1-1.061-1.061 3 3 0 1 1 2.871 5.026v.345a.75.75 0 0 1-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 1 0 8.94 6.94zM10 15a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" clip-rule="evenodd" /></svg><div class="absolute bottom-full left-1/2 z-20 mb-2 w-64 -translate-x-1/2 transform rounded-lg bg-gray-900 border border-gray-700 p-3 text-center text-xs text-gray-300 opacity-0 shadow-lg transition-opacity group-hover:opacity-100 pointer-events-none">The average annual return you expect from your RRSP investments, used to calculate the opportunity cost.</div></div>
        </label>
        <input type="number" id="investmentGrowthRate" formControlName="investmentGrowthRate" step="0.1" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white p-2 focus:ring-pink-500 focus:border-pink-500">
      </div>
       <div>
        <label for="yearsToGrow" class="block text-sm font-medium text-gray-300">Years Until Retirement</label>
        <input type="number" id="yearsToGrow" formControlName="yearsToGrow" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white p-2 focus:ring-pink-500 focus:border-pink-500">
      </div>
    </form>
  </section>

  <!-- Results Section -->
  <section class="mt-8 pt-8 border-t border-gray-700/50">
    <h3 class="text-2xl font-semibold text-center mb-6 text-gray-200">HBP Impact Analysis</h3>
    @if(hbpForm.valid) {
      <div class="bg-gray-900/50 rounded-lg p-6 space-y-6">
        
        <!-- Repayment Details -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="bg-gray-800/50 p-4 rounded-lg text-center">
            <h4 class="font-semibold text-white mb-2">Required Annual Repayment</h4>
            <p class="text-3xl font-bold text-pink-400">{{ requiredAnnualRepayment() | currency:'USD':'symbol':'1.2-2' }}</p>
            <p class="text-xs text-gray-500 mt-2">You must repay at least 1/15th of the withdrawn amount each year, starting the second year after withdrawal.</p>
          </div>
          <div class="bg-gray-800/50 p-4 rounded-lg text-center">
            <h4 class="font-semibold text-white mb-2">Tax Cost of Missed Repayment</h4>
            <p class="text-3xl font-bold text-red-400">{{ taxCostOfMissedPayment() | currency }}</p>
            <p class="text-xs text-gray-500 mt-2">If you miss a payment, that amount is added to your taxable income for the year.</p>
          </div>
        </div>

        <!-- Opportunity Cost -->
        <div class="text-center bg-gray-800/50 p-6 rounded-lg">
            <h4 class="font-semibold text-white mb-3 flex items-center justify-center gap-1">
              <span>Long-Term Opportunity Cost</span>
              <div class="group relative"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-400 cursor-help"><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0zM8.94 6.94a.75.75 0 1 1-1.061-1.061 3 3 0 1 1 2.871 5.026v.345a.75.75 0 0 1-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 1 0 8.94 6.94zM10 15a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" clip-rule="evenodd" /></svg><div class="absolute bottom-full left-1/2 z-20 mb-2 w-72 -translate-x-1/2 transform rounded-lg bg-gray-900 border border-gray-700 p-3 text-center text-xs text-gray-300 opacity-0 shadow-lg transition-opacity group-hover:opacity-100 pointer-events-none">This estimates how much your withdrawn funds could have grown to by retirement if they had remained invested in your RRSP, providing tax-sheltered compound growth.</div></div>
            </h4>
            <p class="text-lg text-gray-300">
              Your <strong class="text-white">{{ hbpForm.value.withdrawalAmount | currency:'USD':'symbol':'1.0-0' }}</strong> withdrawal could have grown to 
              <strong class="text-pink-400 text-xl">{{ futureValueOfWithdrawal() | currency:'USD':'symbol':'1.0-0' }}</strong> 
              in {{ hbpForm.value.yearsToGrow }} years.
            </p>
            <p class="text-lg text-gray-300 mt-2">
                That's a potential lost growth of <strong class="text-yellow-400 text-xl">{{ opportunityCost() | currency:'USD':'symbol':'1.0-0' }}</strong>.
            </p>
        </div>

        <div class="text-center text-xs text-gray-500 pt-4">
          <p><strong>Disclaimer:</strong> This is an estimate for informational purposes. Investment returns are not guaranteed. The HBP has specific eligibility rules and repayment conditions. Consult with a financial advisor.</p>
        </div>
      </div>
    } @else {
      <div class="text-center py-8 px-4 bg-gray-900/50 rounded-lg">
        <p class="text-gray-400">Please fill out all fields to analyze the Home Buyers' Plan.</p>
      </div>
    }
  </section>
</div>

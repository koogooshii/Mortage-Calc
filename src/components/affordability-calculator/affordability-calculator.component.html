<div class="bg-gray-800/50 backdrop-blur-sm rounded-xl shadow-2xl p-6 border border-gray-700 space-y-8 max-w-5xl mx-auto">
    
  <!-- Form Section -->
  <section>
    <form [formGroup]="affordabilityForm" class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
      <!-- Column 1 -->
      <div class="space-y-6">
        <div>
          <label for="annualIncome" class="block text-sm font-medium text-gray-300 flex items-center gap-1">
            <span>Gross Annual Income</span>
            <div class="group relative">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-400 cursor-help"><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0zM8.94 6.94a.75.75 0 1 1-1.061-1.061 3 3 0 1 1 2.871 5.026v.345a.75.75 0 0 1-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 1 0 8.94 6.94zM10 15a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" clip-rule="evenodd" /></svg>
                <div class="absolute bottom-full left-1/2 z-20 mb-2 w-64 -translate-x-1/2 transform rounded-lg bg-gray-900 border border-gray-700 p-3 text-center text-xs text-gray-300 opacity-0 shadow-lg transition-opacity group-hover:opacity-100 pointer-events-none">Your total income from all sources before any taxes or deductions are taken out.</div>
            </div>
          </label>
          <input type="number" id="annualIncome" formControlName="annualIncome" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white p-2 focus:ring-blue-500 focus:border-blue-500">
          <p class="mt-1 text-xs text-gray-400">Your total yearly income before taxes.</p>
        </div>
        <div>
          <label for="monthlyDebts" class="block text-sm font-medium text-gray-300 flex items-center gap-1">
            <span>Total Monthly Debts</span>
             <div class="group relative">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-400 cursor-help"><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0zM8.94 6.94a.75.75 0 1 1-1.061-1.061 3 3 0 1 1 2.871 5.026v.345a.75.75 0 0 1-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 1 0 8.94 6.94zM10 15a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" clip-rule="evenodd" /></svg>
                <div class="absolute bottom-full left-1/2 z-20 mb-2 w-64 -translate-x-1/2 transform rounded-lg bg-gray-900 border border-gray-700 p-3 text-center text-xs text-gray-300 opacity-0 shadow-lg transition-opacity group-hover:opacity-100 pointer-events-none">Sum of all your recurring monthly debt payments (e.g., car loans, student loans, credit card minimums). Do not include rent.</div>
            </div>
          </label>
          <input type="number" id="monthlyDebts" formControlName="monthlyDebts" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white p-2 focus:ring-blue-500 focus:border-blue-500">
          <p class="mt-1 text-xs text-gray-400">Sum of all monthly payments (e.g., car loan, student loan, credit cards). Do not include rent.</p>
        </div>
         <div>
          <label for="downPayment" class="block text-sm font-medium text-gray-300 flex items-center gap-1">
            <span>Down Payment</span>
             <div class="group relative">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-400 cursor-help"><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0zM8.94 6.94a.75.75 0 1 1-1.061-1.061 3 3 0 1 1 2.871 5.026v.345a.75.75 0 0 1-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 1 0 8.94 6.94zM10 15a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" clip-rule="evenodd" /></svg>
                <div class="absolute bottom-full left-1/2 z-20 mb-2 w-64 -translate-x-1/2 transform rounded-lg bg-gray-900 border border-gray-700 p-3 text-center text-xs text-gray-300 opacity-0 shadow-lg transition-opacity group-hover:opacity-100 pointer-events-none">The amount of cash you will pay upfront.</div>
            </div>
          </label>
          <input type="number" id="downPayment" formControlName="downPayment" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white p-2 focus:ring-blue-500 focus:border-blue-500">
          <p class="mt-1 text-xs text-gray-400">The amount of cash you will pay upfront.</p>
        </div>
      </div>

      <!-- Column 2 -->
      <div class="space-y-6">
        <div class="grid grid-cols-2 gap-4">
            <div>
                <label for="interestRate" class="block text-sm font-medium text-gray-300">Interest Rate (%)</label>
                <input type="number" id="interestRate" formControlName="interestRate" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white p-2 focus:ring-blue-500 focus:border-blue-500">
                 <p class="mt-1 text-xs text-gray-400">Estimated mortgage rate.</p>
            </div>
            <div>
                <label for="loanTerm" class="block text-sm font-medium text-gray-300">Loan Term (Years)</label>
                <input type="number" id="loanTerm" formControlName="loanTerm" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white p-2 focus:ring-blue-500 focus:border-blue-500">
                <p class="mt-1 text-xs text-gray-400">Typically 15 or 30.</p>
            </div>
            <div>
                 <label for="frontEndDTI" class="block text-sm font-medium text-gray-300 flex items-center gap-1">
                    <span>Front-End DTI (%)</span>
                    <div class="group relative">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-400 cursor-help"><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0zM8.94 6.94a.75.75 0 1 1-1.061-1.061 3 3 0 1 1 2.871 5.026v.345a.75.75 0 0 1-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 1 0 8.94 6.94zM10 15a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" clip-rule="evenodd" /></svg>
                        <div class="absolute bottom-full left-1/2 z-20 mb-2 w-64 -translate-x-1/2 transform rounded-lg bg-gray-900 border border-gray-700 p-3 text-center text-xs text-gray-300 opacity-0 shadow-lg transition-opacity group-hover:opacity-100 pointer-events-none">Debt-to-Income ratio for housing costs only. Lenders prefer this to be 28-31% or less.</div>
                    </div>
                </label>
                <input type="number" id="frontEndDTI" formControlName="frontEndDTI" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white p-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div>
                 <label for="backEndDTI" class="block text-sm font-medium text-gray-300 flex items-center gap-1">
                    <span>Back-End DTI (%)</span>
                    <div class="group relative">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-400 cursor-help"><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0zM8.94 6.94a.75.75 0 1 1-1.061-1.061 3 3 0 1 1 2.871 5.026v.345a.75.75 0 0 1-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 1 0 8.94 6.94zM10 15a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" clip-rule="evenodd" /></svg>
                        <div class="absolute bottom-full left-1/2 z-20 mb-2 w-64 -translate-x-1/2 transform rounded-lg bg-gray-900 border border-gray-700 p-3 text-center text-xs text-gray-300 opacity-0 shadow-lg transition-opacity group-hover:opacity-100 pointer-events-none">Debt-to-Income ratio for all debts including housing. Lenders prefer this to be 36-43% or less.</div>
                    </div>
                 </label>
                <input type="number" id="backEndDTI" formControlName="backEndDTI" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white p-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
        </div>
        
        <div>
          <div>
             <label for="propertyTax" class="block text-sm font-medium text-gray-300">Annual Property Tax</label>
          </div>
          <div class="flex items-center mt-1">
              <input type="number" id="propertyTax" formControlName="propertyTax" class="block w-full bg-gray-700 border-gray-600 rounded-l-md text-white p-2 focus:ring-blue-500 focus:border-blue-500">
              <div class="flex items-center text-sm border border-l-0 border-gray-600 rounded-r-md">
                  <button type="button" (click)="taxInputType.set('percent')" [class.bg-blue-600]="taxInputType() === 'percent'" class="px-3 py-2 transition">%</button>
                  <button type="button" (click)="taxInputType.set('value')" [class.bg-blue-600]="taxInputType() === 'value'" class="px-3 py-2 transition rounded-r-md">$</button>
              </div>
          </div>
          <p class="mt-1 text-xs text-gray-400">Estimated property tax, as a percentage of home value or a fixed annual amount.</p>
        </div>

        <div>
            <label for="homeInsurance" class="block text-sm font-medium text-gray-300">Annual Home Insurance</label>
            <div class="flex items-center mt-1">
              <input type="number" id="homeInsurance" formControlName="homeInsurance" class="block w-full bg-gray-700 border-gray-600 rounded-l-md text-white p-2 focus:ring-blue-500 focus:border-blue-500">
                <div class="flex items-center text-sm border border-l-0 border-gray-600 rounded-r-md">
                  <button type="button" (click)="insuranceInputType.set('percent')" [class.bg-blue-600]="insuranceInputType() === 'percent'" class="px-3 py-2 transition">%</button>
                  <button type="button" (click)="insuranceInputType.set('value')" [class.bg-blue-600]="insuranceInputType() === 'value'" class="px-3 py-2 transition rounded-r-md">$</button>
              </div>
            </div>
            <p class="mt-1 text-xs text-gray-400">Estimated insurance, as a percentage of home value or a fixed annual amount.</p>
        </div>
      </div>
    </form>
  </section>

  <!-- Results Section -->
  <section class="mt-8 pt-8 border-t border-gray-700/50">
    <h3 class="text-2xl font-semibold text-center mb-6 text-gray-200">Your Estimated Affordability</h3>
    @if(affordabilityForm.valid) {
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          @if(result28(); as result) {
            <div class="bg-gray-900/50 rounded-lg p-6 text-center border-t-4 border-blue-500"><h4 class="text-xl font-bold text-blue-400 flex items-center justify-center gap-1"><span>Standard Guideline ({{ affordabilityForm.value.frontEndDTI }}% DTI)</span><div class="group relative"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-400 cursor-help"><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0zM8.94 6.94a.75.75 0 1 1-1.061-1.061 3 3 0 1 1 2.871 5.026v.345a.75.75 0 0 1-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 1 0 8.94 6.94zM10 15a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" clip-rule="evenodd" /></svg><div class="absolute bottom-full left-1/2 z-20 mb-2 w-64 -translate-x-1/2 transform rounded-lg bg-gray-900 border border-gray-700 p-3 text-center text-xs text-gray-300 opacity-0 shadow-lg transition-opacity group-hover:opacity-100 pointer-events-none">Calculates max price using only your housing costs (PITI) against your income. This is a more aggressive estimate.</div></div></h4><p class="text-xs text-gray-400 mb-4">Based on housing costs only (PITI)</p><div class="my-4"><p class="text-lg text-gray-300">Max Affordable Home Price</p><p class="text-4xl font-extrabold text-white tracking-tight">{{ result.maxHomePrice | currency:'USD':'symbol':'1.0-0' }}</p></div><div class="space-y-3 text-sm"><div class="flex justify-between items-center bg-gray-800/50 p-2 rounded-md"><span class="text-gray-400">Max Loan Amount:</span><span class="font-mono">{{ result.maxLoanAmount | currency:'USD':'symbol':'1.0-0' }}</span></div><div class="flex justify-between items-center bg-gray-800/50 p-2 rounded-md"><span class="text-gray-400">Estimated Monthly PITI:</span><span class="font-mono">{{ result.maxMonthlyPITI | currency }}</span></div><div class="pl-4 text-xs space-y-1 mt-1 border-l-2 border-gray-700 text-left"><p class="flex justify-between"><span>Principal & Interest:</span> <span class="font-mono">{{ result.monthlyPrincipalAndInterest | currency }}</span></p><p class="flex justify-between"><span>Property Tax:</span> <span class="font-mono">{{ result.monthlyTaxes | currency }}</span></p><p class="flex justify-between"><span>Home Insurance:</span> <span class="font-mono">{{ result.monthlyInsurance | currency }}</span></p><p class="flex justify-between"><span>PMI:</span> <span class="font-mono">{{ affordabilityForm.value.monthlyPMI | currency }}</span></p></div></div></div>
          }
          @if(result36(); as result) {
            <div class="bg-gray-900/50 rounded-lg p-6 text-center border-t-4 border-cyan-500"><h4 class="text-xl font-bold text-cyan-400 flex items-center justify-center gap-1"><span>Conservative Guideline ({{ affordabilityForm.value.backEndDTI }}% DTI)</span><div class="group relative"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-400 cursor-help"><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0zM8.94 6.94a.75.75 0 1 1-1.061-1.061 3 3 0 1 1 2.871 5.026v.345a.75.75 0 0 1-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 1 0 8.94 6.94zM10 15a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" clip-rule="evenodd" /></svg><div class="absolute bottom-full left-1/2 z-20 mb-2 w-64 -translate-x-1/2 transform rounded-lg bg-gray-900 border border-gray-700 p-3 text-center text-xs text-gray-300 opacity-0 shadow-lg transition-opacity group-hover:opacity-100 pointer-events-none">Calculates max price using all your debts (including housing) against your income. This is a more conservative and realistic estimate.</div></div></h4><p class="text-xs text-gray-400 mb-4">Based on housing costs + all other debts</p><div class="my-4"><p class="text-lg text-gray-300">Max Affordable Home Price</p><p class="text-4xl font-extrabold text-white tracking-tight">{{ result.maxHomePrice | currency:'USD':'symbol':'1.0-0' }}</p></div><div class="space-y-3 text-sm"><div class="flex justify-between items-center bg-gray-800/50 p-2 rounded-md"><span class="text-gray-400">Max Loan Amount:</span><span class="font-mono">{{ result.maxLoanAmount | currency:'USD':'symbol':'1.0-0' }}</span></div><div class="flex justify-between items-center bg-gray-800/50 p-2 rounded-md"><span class="text-gray-400">Estimated Monthly PITI:</span><span class="font-mono">{{ result.maxMonthlyPITI | currency }}</span></div><div class="pl-4 text-xs space-y-1 mt-1 border-l-2 border-gray-700 text-left"><p class="flex justify-between"><span>Principal & Interest:</span> <span class="font-mono">{{ result.monthlyPrincipalAndInterest | currency }}</span></p><p class="flex justify-between"><span>Property Tax:</span> <span class="font-mono">{{ result.monthlyTaxes | currency }}</span></p><p class="flex justify-between"><span>Home Insurance:</span> <span class="font-mono">{{ result.monthlyInsurance | currency }}</span></p><p class="flex justify-between"><span>PMI:</span> <span class="font-mono">{{ affordabilityForm.value.monthlyPMI | currency }}</span></p></div></div></div>
          }
      </div>
    } @else {
      <div class="text-center py-8 px-4 bg-gray-900/50 rounded-lg"><p class="text-gray-400">Please fill out all the fields to see your affordability estimate.</p></div>
    }
  </section>
</div>
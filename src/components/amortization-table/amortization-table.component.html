
<div class="flex items-center justify-end mb-4">
    <div class="flex items-center gap-1 p-1 bg-gray-900 rounded-lg">
        <button
            (click)="viewMode.set('detailed')"
            class="px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200"
            [class.bg-gray-700]="viewMode() === 'detailed'"
            [class.text-white]="viewMode() === 'detailed'"
            [class.hover:bg-gray-700/50]="viewMode() !== 'detailed'"
        >
            Detailed
        </button>
        <button
            (click)="viewMode.set('monthly')"
            class="px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200"
            [class.bg-gray-700]="viewMode() === 'monthly'"
            [class.text-white]="viewMode() === 'monthly'"
            [class.hover:bg-gray-700/50]="viewMode() !== 'monthly'"
        >
            Monthly
        </button>
        <button
            (click)="viewMode.set('yearly')"
            class="px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200"
            [class.bg-gray-700]="viewMode() === 'yearly'"
            [class.text-white]="viewMode() === 'yearly'"
            [class.hover:bg-gray-700/50]="viewMode() !== 'yearly'"
        >
            Yearly
        </button>
    </div>
</div>

<div class="max-h-[500px] overflow-y-auto rounded-lg border border-gray-700 shadow-lg">
  @switch (viewMode()) {
    @case ('detailed') {
      <table class="min-w-full divide-y divide-gray-700">
        <thead class="bg-gray-800 sticky top-0 z-10">
          <tr>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">#</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Date</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Payment</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Scheduled Extra</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Ad-Hoc Extra</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Principal</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Interest</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Balance</th>
          </tr>
        </thead>
        <tbody class="bg-gray-800/50 divide-y divide-gray-700 text-gray-300">
          @for (entry of schedule(); track entry.paymentNumber; let i = $index) {
            <tr class="hover:bg-gray-700/50" [class.bg-gray-700/80]="entry.isDeferred">
              <td class="py-3 px-2 text-sm">{{ entry.paymentNumber }}</td>
              <td class="py-3 px-2 text-sm">{{ entry.paymentDate | date:'yyyy-MM-dd' }}</td>
              <td class="py-3 px-2 text-sm">{{ entry.payment | currency }}</td>
              <td class="py-3 px-2 text-sm text-green-400">
                @if(entry.scheduledExtraPayment > 0) {
                  {{ entry.scheduledExtraPayment | currency }}
                }
              </td>
              <td class="py-3 px-2 text-sm">
                <input 
                  type="number"
                  [value]="entry.adHocPayment > 0 ? entry.adHocPayment : ''"
                  (change)="onAdHocPaymentChange(entry.paymentNumber, $event)"
                  placeholder="Add extra"
                  class="w-28 bg-gray-600/50 border-gray-500 rounded-md text-white text-sm p-1 focus:ring-cyan-500 focus:border-cyan-500 placeholder:text-gray-500"
                  [class.text-green-300]="entry.adHocPayment > 0"
                >
              </td>
              <td class="py-3 px-2 text-sm">{{ entry.principal | currency }}</td>
              <td class="py-3 px-2 text-sm text-yellow-400">{{ entry.interest | currency }}</td>
              <td 
                class="py-3 px-2 text-sm font-medium"
                [class]="entry.isDeferred && i > 0 && schedule()[i-1] && entry.remainingBalance > schedule()[i-1].remainingBalance ? 'text-red-400' : 'text-white'">
                {{ entry.remainingBalance | currency }}
              </td>
            </tr>
          }
        </tbody>
      </table>
    }
    @case ('monthly') {
      <table class="min-w-full divide-y divide-gray-700">
        <thead class="bg-gray-800 sticky top-0 z-10">
          <tr>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Month</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Total Payment</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Extra Payments</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Principal</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Interest</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">End Balance</th>
          </tr>
        </thead>
        <tbody class="bg-gray-800/50 divide-y divide-gray-700 text-gray-300">
          @for (entry of monthlySchedule(); track entry.period) {
            <tr class="hover:bg-gray-700/50">
              <td class="py-3 px-2 text-sm font-medium">{{ entry.period }}</td>
              <td class="py-3 px-2 text-sm">{{ entry.totalPayment | currency }}</td>
              <td class="py-3 px-2 text-sm text-green-400">{{ entry.extraPayment | currency }}</td>
              <td class="py-3 px-2 text-sm">{{ entry.principal | currency }}</td>
              <td class="py-3 px-2 text-sm text-yellow-400">{{ entry.interest | currency }}</td>
              <td class="py-3 px-2 text-sm font-medium text-white">{{ entry.endBalance | currency }}</td>
            </tr>
          }
        </tbody>
      </table>
    }
    @case ('yearly') {
       <table class="min-w-full divide-y divide-gray-700">
        <thead class="bg-gray-800 sticky top-0 z-10">
          <tr>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Year</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Total Paid</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Extra Payments</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Principal Paid</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Interest Paid</th>
            <th scope="col" class="py-3 px-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">End of Year Balance</th>
          </tr>
        </thead>
        <tbody class="bg-gray-800/50 divide-y divide-gray-700 text-gray-300">
          @for (entry of yearlySchedule(); track entry.period) {
            <tr class="hover:bg-gray-700/50">
              <td class="py-3 px-2 text-sm font-medium">{{ entry.period }}</td>
              <td class="py-3 px-2 text-sm">{{ entry.totalPayment | currency }}</td>
              <td class="py-3 px-2 text-sm text-green-400">{{ entry.extraPayment | currency }}</td>
              <td class="py-3 px-2 text-sm">{{ entry.principal | currency }}</td>
              <td class="py-3 px-2 text-sm text-yellow-400">{{ entry.interest | currency }}</td>
              <td class="py-3 px-2 text-sm font-medium text-white">{{ entry.endBalance | currency }}</td>
            </tr>
          }
        </tbody>
      </table>
    }
  }
</div>
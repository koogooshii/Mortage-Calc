<main class="container mx-auto p-4 sm:p-6 lg:p-8">
  <header class="mb-8 space-y-6">
    <!-- Main Title and Nav -->
    <div class="flex justify-between items-center flex-wrap gap-4">
      <h1 class="text-4xl font-extrabold text-white tracking-tight">Advanced Mortgage Calculator</h1>
      <nav class="flex items-center gap-1 rounded-lg p-1 bg-gray-700/50">
        <button (click)="setMode('compare')" 
          class="px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200"
          [class.bg-cyan-600]="mode() === 'compare'"
          [class.text-white]="mode() === 'compare'"
          [class.text-gray-300]="mode() !== 'compare'"
          [class.hover:bg-gray-600]="mode() !== 'compare'">
          Compare Scenarios
        </button>
        <button (click)="setMode('toolkit')" 
          class="px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200"
          [class.bg-cyan-600]="mode() !== 'compare'"
          [class.text-white]="mode() !== 'compare'"
          [class.text-gray-300]="mode() === 'compare'"
          [class.hover:bg-gray-600]="mode() === 'compare'">
          Toolkit
        </button>
      </nav>
    </div>

    <!-- Sub-header for context actions -->
    <div class="h-10 flex justify-between items-center px-1">
      <div class="flex items-center gap-4">
        @if(mode() !== 'compare' && mode() !== 'toolkit') {
          <button (click)="setMode('toolkit')" class="px-3 py-1.5 bg-gray-600 hover:bg-gray-500 text-white text-xs font-semibold rounded-md shadow-sm transition-colors duration-200 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
              <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 0 1-.02 1.06L8.832 10l3.938 3.71a.75.75 0 1 1-1.04 1.08l-4.5-4.25a.75.75 0 0 1 0-1.08l4.5-4.25a.75.75 0 0 1 1.06.02Z" clip-rule="evenodd" />
            </svg>
            Back to Toolkit
          </button>
        }
        <h2 class="text-2xl font-bold text-white">{{ pageTitle() }}</h2>
      </div>
      
      @if (mode() === 'compare') {
        <button
            (click)="addScenario()"
            [disabled]="scenarios().length >= 3"
            class="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-semibold rounded-lg shadow-md transition-colors duration-200"
          >
            Add Scenario
          </button>
      } @else {
        <div></div> <!-- Placeholder for alignment -->
      }
    </div>
  </header>

  @switch (mode()) {
    @case ('toolkit') {
      <app-dashboard (modeSelected)="onModeSelected($event)" />
    }
    @case ('compare') {
      <div
        class="transition-all duration-500 ease-in-out"
        [class]="gridClasses()"
      >
        @for (scenario of scenarios(); track i; let i = $index) {
          <div class="w-full" [class.max-w-4xl]="scenarios().length === 1">
            <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl shadow-2xl p-6 border border-gray-700">
              <header class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-semibold"
                    [class]="'text-' + scenarioColors[i] + '-400'">
                  Scenario {{ i + 1 }}
                </h2>
                @if (scenarios().length > 1) {
                  <button
                    (click)="removeScenario(i)"
                    class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-sm font-semibold rounded-md shadow-sm transition-colors duration-200"
                  >
                    Remove
                  </button>
                }
              </header>
              <app-mortgage-calculator 
                [state]="scenario"
                (stateChange)="updateScenario(i, $event)"
                [color]="scenarioColors[i]" 
                [scenarioCount]="scenarios().length" 
                [scenarioIndex]="i" />
            </div>
          </div>
        }
      </div>
    }
    @case ('refinance') {
      <app-refinance-calculator />
    }
    @case ('history') {
      <app-loan-history />
    }
    @case ('features') {
      <app-feature-suggestions />
    }
    @case ('planner') {
      <app-pre-purchase-planner />
    }
    @case ('rental') {
      <app-rental-investment-calculator />
    }
    @case ('heloc') {
      <app-heloc-calculator />
    }
    @case ('blended') {
      <app-blended-mortgage-calculator />
    }
    @case ('portability') {
      <app-portability-analyzer />
    }
    
  }
</main>